{{ define "title" }}Cart{{ end }}
{{ template "base" . }}
{{ define "content" }}
<h1 class="text-2xl font-bold mb-4">Ваша корзина</h1>

{{ if .Rows }}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <!-- список позиций -->
  <div class="lg:col-span-2 space-y-4">
    {{ range .Rows }}
    <div class="bg-white p-4 rounded shadow flex items-center gap-4">
      {{ if .Product.ImagePath }}
        <img src="{{ .Product.ImagePath }}" alt="{{ .Product.Title }}" class="w-20 h-20 object-cover rounded">
      {{ else }}
        <div class="w-20 h-20 bg-gray-200 rounded"></div>
      {{ end }}

      <div class="flex-1">
        <div class="font-semibold">{{ .Product.Title }}</div>
        <div class="text-xs text-gray-500">Продавец: #{{ .Product.SellerID }}</div>
        <div class="text-sm text-gray-600">{{ .Product.Description }}</div>
      </div>

      <form method="POST" action="/cart/update" class="flex items-center gap-2">
        <input type="hidden" name="product_id" value="{{ .Product.ID }}">
        <button name="qty" value="{{ sub .Qty 1 }}" class="px-2 py-1 border rounded" {{ if le .Qty 1 }}disabled{{ end }}>−</button>
        <input type="number" name="qty" min="1" value="{{ .Qty }}" class="w-16 border p-2 rounded text-center">
        <button class="px-2 py-1 border rounded">Обновить</button>
      </form>

      <div class="w-28 text-right font-bold">$ {{ price .SubtotalCents }}</div>

      <form method="POST" action="/cart/remove">
        <input type="hidden" name="product_id" value="{{ .Product.ID }}">
        <button class="ml-3 px-3 py-2 bg-red-600 text-white rounded">Удалить</button>
      </form>
    </div>
    {{ end }}
  </div>

  <!-- боковая панель итога -->
  <div class="bg-white p-4 rounded shadow h-fit">
    <div class="flex justify-between mb-2">
      <span class="text-gray-600">Товары</span>
      <span class="font-semibold">$ {{ price .TotalCents }}</span>
    </div>
    <div class="flex justify-between mb-4">
      <span class="text-gray-600">Доставка</span>
      <span class="font-semibold">—</span>
    </div>
    <div class="flex justify-between text-lg font-bold mb-4">
      <span>Итого</span>
      <span>$ {{ price .TotalCents }}</span>
    </div>
    <button class="w-full py-3 rounded bg-indigo-600 text-white font-semibold">Перейти к оформлению</button>

    <form method="POST" action="/cart/clear" class="mt-3">
      <button class="w-full py-2 rounded border">Очистить корзину</button>
    </form>
  </div>
</div>
{{ else }}
  <div class="bg-white p-10 rounded shadow text-center">
    <p class="text-lg">В корзине пока пусто</p>
    <a href="/" class="inline-block mt-4 px-4 py-2 bg-indigo-600 text-white rounded">На главную</a>
  </div>
{{ end }}
{{ end }}
